{% extends "base.html" %}

{% block title %}Создание качественной шкалы{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Создание качественной шкалы оценки уязвимостей</h2>

        <form id="scale-form">
            <div class="mb-3">
                <label for="levels_count" class="form-label">Количество уровней</label>
                <input type="number" class="form-control" id="levels_count" min="1" max="10" value="3">
            </div>
            <div id="levels-container">
                <!-- Уровни будут добавляться динамически -->
            </div>
            <button type="button" class="btn btn-primary" onclick="generateLevels()">Создать уровни</button>
            <button type="button" class="btn btn-success" onclick="saveScale()">Сохранить шкалу</button>
        </form>
    </div>
</div>

<script>
function generateLevels() {
    const count = document.getElementById('levels_count').value;
    const container = document.getElementById('levels-container');
    container.innerHTML = '';

    for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.className = 'mb-3';
        div.innerHTML = `
            <label class="form-label">Уровень ${i}</label>
            <input type="text" class="form-control" placeholder="Название уровня" id="level-name-${i}">
            <textarea class="form-control mt-2" placeholder="Описание уровня" id="level-desc-${i}"></textarea>
        `;
        container.appendChild(div);
    }
}

function saveScale() {
    const count = document.getElementById('levels_count').value;
    const levels = [];
    for (let i = 1; i <= count; i++) {
        const name = document.getElementById(`level-name-${i}`).value.trim();
        const desc = document.getElementById(`level-desc-${i}`).value.trim();
        if (name) {
            levels.push({ name, description: desc });
        }
    }

    if (levels.length === 0) {
        showNotification('Добавьте хотя бы один уровень', 'warning');
        return;
    }

    // Сохранить в localStorage или отправить на сервер
    localStorage.setItem('vulnerability_scale', JSON.stringify(levels));
    showNotification('Шкала сохранена', 'success');
    window.location.href = '/vulnerabilities/assess';
}

document.addEventListener('DOMContentLoaded', function() {
    generateLevels();
});
</script>
{% endblock %}