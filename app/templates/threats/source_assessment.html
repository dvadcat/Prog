{% extends "base.html" %}

{% block title %}Оценка признака "Источник угрозы ИБ" - Программное средство для оценки рисков ИБ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Оценка признака "Источник угрозы ИБ"</h2>
        
        <form method="POST" id="source-assessment-form">
            <div class="mb-3">
                <label for="selected_threat" class="form-label">Выберите угрозу</label>
                <select class="form-control" id="selected_threat" name="selected_threat" required>
                    <option value="">Выберите угрозу...</option>
                    {% for threat in threats %}
                    <option value="{{ threat.id }}" data-name="{{ threat.name }}">
                        {{ threat.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
</div>

<div class="row mt-4" id="assessment-table" style="display: none;">
    <div class="col-12">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Признак</th>
                    <th>1 балл</th>
                    <th>2 балла</th>
                    <th>3 балла</th>
                    <th>4 балла</th>
                    <th>Выбранное значение</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Мотивация ИУ</td>
                    <td><input type="radio" name="motivation" value="1" class="form-check-input"></td>
                    <td><input type="radio" name="motivation" value="2" class="form-check-input"></td>
                    <td><input type="radio" name="motivation" value="3" class="form-check-input"></td>
                    <td><input type="radio" name="motivation" value="4" class="form-check-input"></td>
                    <td id="motivation-value">-</td>
                </tr>
                <tr>
                    <td>Квалификация ИУ</td>
                    <td><input type="radio" name="qualification" value="1" class="form-check-input"></td>
                    <td><input type="radio" name="qualification" value="2" class="form-check-input"></td>
                    <td><input type="radio" name="qualification" value="3" class="form-check-input"></td>
                    <td><input type="radio" name="qualification" value="4" class="form-check-input"></td>
                    <td id="qualification-value">-</td>
                </tr>
                <tr>
                    <td>Ресурсы ИУ</td>
                    <td><input type="radio" name="resources" value="1" class="form-check-input"></td>
                    <td><input type="radio" name="resources" value="2" class="form-check-input"></td>
                    <td><input type="radio" name="resources" value="3" class="form-check-input"></td>
                    <td><input type="radio" name="resources" value="4" class="form-check-input"></td>
                    <td id="resources-value">-</td>
                </tr>
                <tr>
                    <td>Расположение ИУ относительно области применения УРИБ</td>
                    <td><input type="radio" name="location" value="1" class="form-check-input"></td>
                    <td><input type="radio" name="location" value="2" class="form-check-input"></td>
                    <td><input type="radio" name="location" value="3" class="form-check-input"></td>
                    <td><input type="radio" name="location" value="4" class="form-check-input"></td>
                    <td id="location-value">-</td>
                </tr>
            </tbody>
        </table>
        
        <div class="mt-3">
            <h4>Результаты оценки</h4>
            <p>Максимальное значение признаков: 4 балла</p>
            <p>Количество признаков: 4</p>
            <p id="assessment-result">Оценка: -</p>
            <button type="button" class="btn btn-primary" onclick="calculateAssessment()">Рассчитать оценку</button>
        </div>
    </div>
</div>

<script>
document.getElementById('selected_threat').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    if (selectedOption.value) {
        // Показываем таблицу
        document.getElementById('assessment-table').style.display = 'block';
        
        // Сбрасываем все выбранные значения
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.checked = false;
        });
        
        // Сбрасываем результаты
        document.getElementById('motivation-value').textContent = '-';
        document.getElementById('qualification-value').textContent = '-';
        document.getElementById('resources-value').textContent = '-';
        document.getElementById('location-value').textContent = '-';
        document.getElementById('assessment-result').textContent = 'Оценка: -';
    } else {
        // Скрываем таблицу
        document.getElementById('assessment-table').style.display = 'none';
    }
});

// Обработчики для обновления отображаемых значений
document.querySelectorAll('input[name="motivation"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('motivation-value').textContent = this.value;
    });
});

document.querySelectorAll('input[name="qualification"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('qualification-value').textContent = this.value;
    });
});

document.querySelectorAll('input[name="resources"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('resources-value').textContent = this.value;
    });
});

document.querySelectorAll('input[name="location"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('location-value').textContent = this.value;
    });
});

function calculateAssessment() {
    const motivation = document.querySelector('input[name="motivation"]:checked');
    const qualification = document.querySelector('input[name="qualification"]:checked');
    const resources = document.querySelector('input[name="resources"]:checked');
    const location = document.querySelector('input[name="location"]:checked');
    
    if (!motivation || !qualification || !resources || !location) {
        alert('Пожалуйста, выберите значение для всех признаков');
        return;
    }
    
    const A1 = parseInt(motivation.value);
    const A2 = parseInt(qualification.value);
    const A3 = parseInt(resources.value);
    const A4 = parseInt(location.value);
    
    const Amax = 4; // максимальное значение признаков
    const k = 4; // количество признаков
    
    const result = (A1 + A2 + A3 + A4) / (Amax * k);
    
    document.getElementById('assessment-result').textContent = `Оценка: ${result.toFixed(4)} (I = (${A1}+${A2}+${A3}+${A4})/(${Amax}*${k}) = ${A1 + A2 + A3 + A4}/${Amax * k} = ${result.toFixed(4)})`;
}
</script>
{% endblock %}