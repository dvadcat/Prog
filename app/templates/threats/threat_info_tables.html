{% extends "base.html" %}

{% block title %}Информация об угрозе - Программное средство для оценки рисков ИБ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Информация об угрозе</h2>
        
        <form method="POST" id="threat-info-form">
            <div class="mb-3">
                <label for="selected_threat" class="form-label">Выберите угрозу</label>
                <select class="form-control" id="selected_threat" name="selected_threat" required>
                    <option value="">Выберите угрозу...</option>
                    {% for threat in threats %}
                    <option value="{{ threat.id }}" data-description="{{ threat.description }}" 
                            data-source="{{ threat.source }}" data-target="{{ threat.target_object }}"
                            data-conf="{{ threat.confidentiality_violation }}" data-int="{{ threat.integrity_violation }}" 
                            data-avail="{{ threat.availability_violation }}">
                        {{ threat.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
</div>

<!-- Угроза некорректного использования функционала -->
<div class="row mt-4" id="table1" style="display: none;">
    <div class="col-12">
        <h3>{{ selected_threat.name if selected_threat else 'Угроза' }}</h3>
        <table class="table table-bordered">
            <tr>
                <td><strong>Описание угрозы</strong></td>
                <td id="table1-description">{{ selected_threat.description if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Источники угрозы</strong></td>
                <td id="table1-source">{{ selected_threat.source if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Объект воздействия</strong></td>
                <td id="table1-target">{{ selected_threat.target_object if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Последствия реализации угрозы</strong></td>
                <td id="table1-consequences">
                    {% if selected_threat %}
                        {% if selected_threat.confidentiality_violation %}Нарушение конфиденциальности<br>{% endif %}
                        {% if selected_threat.integrity_violation %}Нарушение целостности<br>{% endif %}
                        {% if selected_threat.availability_violation %}Нарушение доступности{% endif %}
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
</div>

<!-- Угроза межсайтовой подделки запроса -->
<div class="row mt-4" id="table2" style="display: none;">
    <div class="col-12">
        <h3>{{ selected_threat.name if selected_threat else 'Угроза' }}</h3>
        <table class="table table-bordered">
            <tr>
                <td><strong>Описание угрозы</strong></td>
                <td id="table2-description">{{ selected_threat.description if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Источники угрозы</strong></td>
                <td id="table2-source">{{ selected_threat.source if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Объект воздействия</strong></td>
                <td id="table2-target">{{ selected_threat.target_object if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Последствия реализации угрозы</strong></td>
                <td id="table2-consequences">
                    {% if selected_threat %}
                        {% if selected_threat.confidentiality_violation %}Нарушение конфиденциальности<br>{% endif %}
                        {% if selected_threat.integrity_violation %}Нарушение целостности<br>{% endif %}
                        {% if selected_threat.availability_violation %}Нарушение доступности{% endif %}
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
</div>

<!-- Угроза несанкционированного удаления защищаемой информации -->
<div class="row mt-4" id="table3" style="display: none;">
    <div class="col-12">
        <h3>{{ selected_threat.name if selected_threat else 'Угроза' }}</h3>
        <table class="table table-bordered">
            <tr>
                <td><strong>Описание угрозы</strong></td>
                <td id="table3-description">{{ selected_threat.description if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Источники угрозы</strong></td>
                <td id="table3-source">{{ selected_threat.source if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Объект воздействия</strong></td>
                <td id="table3-target">{{ selected_threat.target_object if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Последствия реализации угрозы</strong></td>
                <td id="table3-consequences">
                    {% if selected_threat %}
                        {% if selected_threat.confidentiality_violation %}Нарушение конфиденциальности<br>{% endif %}
                        {% if selected_threat.integrity_violation %}Нарушение целостности<br>{% endif %}
                        {% if selected_threat.availability_violation %}Нарушение доступности{% endif %}
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
</div>

<!-- Угроза доступа/перехвата/изменения HTTP cookies -->
<div class="row mt-4" id="table4" style="display: none;">
    <div class="col-12">
        <h3>{{ selected_threat.name if selected_threat else 'Угроза' }}</h3>
        <table class="table table-bordered">
            <tr>
                <td><strong>Описание угрозы</strong></td>
                <td id="table4-description">{{ selected_threat.description if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Источники угрозы</strong></td>
                <td id="table4-source">{{ selected_threat.source if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Объект воздействия</strong></td>
                <td id="table4-target">{{ selected_threat.target_object if selected_threat else '' }}</td>
            </tr>
            <tr>
                <td><strong>Последствия реализации угрозы</strong></td>
                <td id="table4-consequences">
                    {% if selected_threat %}
                        {% if selected_threat.confidentiality_violation %}Нарушение конфиденциальности<br>{% endif %}
                        {% if selected_threat.integrity_violation %}Нарушение целостности<br>{% endif %}
                        {% if selected_threat.availability_violation %}Нарушение доступности{% endif %}
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
</div>

<script>
document.getElementById('selected_threat').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    if (selectedOption.value) {
        // Показываем все таблицы
        document.getElementById('table1').style.display = 'block';
        document.getElementById('table2').style.display = 'block';
        document.getElementById('table3').style.display = 'block';
        document.getElementById('table4').style.display = 'block';
        
        // Заполняем данные в таблицах
        document.getElementById('table1-description').textContent = selectedOption.dataset.description || '';
        document.getElementById('table1-source').textContent = selectedOption.dataset.source || '';
        document.getElementById('table1-target').textContent = selectedOption.dataset.target || '';
        
        let consequences1 = '';
        if (selectedOption.dataset.conf === '1') consequences1 += 'Нарушение конфиденциальности<br>';
        if (selectedOption.dataset.int === '1') consequences1 += 'Нарушение целостности<br>';
        if (selectedOption.dataset.avail === '1') consequences1 += 'Нарушение доступности';
        document.getElementById('table1-consequences').innerHTML = consequences1;
        
        document.getElementById('table2-description').textContent = selectedOption.dataset.description || '';
        document.getElementById('table2-source').textContent = selectedOption.dataset.source || '';
        document.getElementById('table2-target').textContent = selectedOption.dataset.target || '';
        
        let consequences2 = '';
        if (selectedOption.dataset.conf === '1') consequences2 += 'Нарушение конфиденциальности<br>';
        if (selectedOption.dataset.int === '1') consequences2 += 'Нарушение целостности<br>';
        if (selectedOption.dataset.avail === '1') consequences2 += 'Нарушение доступности';
        document.getElementById('table2-consequences').innerHTML = consequences2;
        
        document.getElementById('table3-description').textContent = selectedOption.dataset.description || '';
        document.getElementById('table3-source').textContent = selectedOption.dataset.source || '';
        document.getElementById('table3-target').textContent = selectedOption.dataset.target || '';
        
        let consequences3 = '';
        if (selectedOption.dataset.conf === '1') consequences3 += 'Нарушение конфиденциальности<br>';
        if (selectedOption.dataset.int === '1') consequences3 += 'Нарушение целостности<br>';
        if (selectedOption.dataset.avail === '1') consequences3 += 'Нарушение доступности';
        document.getElementById('table3-consequences').innerHTML = consequences3;
        
        document.getElementById('table4-description').textContent = selectedOption.dataset.description || '';
        document.getElementById('table4-source').textContent = selectedOption.dataset.source || '';
        document.getElementById('table4-target').textContent = selectedOption.dataset.target || '';
        
        let consequences4 = '';
        if (selectedOption.dataset.conf === '1') consequences4 += 'Нарушение конфиденциальности<br>';
        if (selectedOption.dataset.int === '1') consequences4 += 'Нарушение целостности<br>';
        if (selectedOption.dataset.avail === '1') consequences4 += 'Нарушение доступности';
        document.getElementById('table4-consequences').innerHTML = consequences4;
    } else {
        // Скрываем все таблицы
        document.getElementById('table1').style.display = 'none';
        document.getElementById('table2').style.display = 'none';
        document.getElementById('table3').style.display = 'none';
        document.getElementById('table4').style.display = 'none';
    }
});
</script>
{% endblock %}