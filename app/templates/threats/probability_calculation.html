{% extends "base.html" %}

{% block title %}Расчет вероятности реализации угрозы - Программное средство для оценки рисков ИБ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Расчет вероятности реализации угрозы</h2>
        
        <form method="POST" id="probability-calculation-form">
            <div class="mb-3">
                <label for="selected_threat" class="form-label">Выберите угрозу</label>
                <select class="form-control" id="selected_threat" name="selected_threat" required>
                    <option value="">Выберите угрозу...</option>
                    {% for threat in threats %}
                    <option value="{{ threat.id }}" data-name="{{ threat.name }}">
                        {{ threat.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
</div>

<div class="row mt-4" id="calculation-table" style="display: none;">
    <div class="col-12">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Угроза</th>
                    <th>Оценка вероятности реализации угрозы</th>
                </tr>
            </thead>
            <tbody>
                <tr id="calculation-row" style="display: none;">
                    <td id="threat-name">-</td>
                    <td>
                        <div class="input-group">
                            <input type="number" class="form-control" id="probability-value" name="probability_value" step="0.0001" min="0" max="1" placeholder="Введите вероятность">
                            <button class="btn btn-outline-secondary" type="button" onclick="calculateProbability()">Рассчитать</button>
                        </div>
                        <div id="calculation-details" class="mt-2" style="display: none;">
                            <p><strong>Формула:</strong> T = (A1 + A2 + A3 + A4) / (Amax * k)</p>
                            <p id="formula-details">Где: A1, A2, A3, A4 - значения признаков; Amax = 4; k = 4</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div class="mt-3">
            <h4>Примеры расчетов:</h4>
            <ul>
                <li><strong>У1:</strong> T=(2+1+1+3)/16= 0,4375</li>
                <li><strong>У2:</strong> T=(1+2+2+3)/16= 0,5</li>
                <li><strong>У3:</strong> T=(1+1+2+3)/16= 0,4375</li>
                <li><strong>У4:</strong> T=(1+2+1+2)/16= 0,375</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.getElementById('selected_threat').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    if (selectedOption.value) {
        // Показываем строку с расчетом
        document.getElementById('calculation-row').style.display = 'table-row';
        
        // Заполняем название угрозы
        document.getElementById('threat-name').textContent = selectedOption.dataset.name;
        
        // Сбрасываем значение вероятности
        document.getElementById('probability-value').value = '';
        document.getElementById('calculation-details').style.display = 'none';
    } else {
        // Скрываем строку с расчетом
        document.getElementById('calculation-row').style.display = 'none';
    }
});

function calculateProbability() {
    const threatSelect = document.getElementById('selected_threat');
    if (!threatSelect.value) {
        alert('Пожалуйста, выберите угрозу');
        return;
    }
    
    // Здесь можно реализовать логику расчета на основе данных из таблицы 9
    // Пока что просто показываем пример расчета
    document.getElementById('calculation-details').style.display = 'block';
    
    // В реальной системе здесь будет логика получения данных из таблицы 9
    // и расчета вероятности, но для демонстрации просто покажем формулу
}
</script>
{% endblock %}